🟣 Final Model3 – Multimodal Harmful Content Detector

Final Model3는 Final Model2를 기반으로, 모델 안정성 · 전처리 일관성 · 데이터 구조 통합을 중점적으로 개선한 최종 버전 멀티모달 유해 콘텐츠 탐지 모델입니다.
영상(Video) + 오디오(Audio) + 텍스트(Text)를 결합한 3-way Fusion 구조를 유지하면서, 학습 중 발생하던 모든 핵심 오류를 해결하고, 실 평가에 사용할 데이터를 반영하기 위해 manifest 구조와 데이터 로더 전체를 리팩토링한 버전입니다.

1. Final Model2 → Final Model3 핵심 개선점
✔ 1) 멀티모달 처리 안정성 대폭 개선

FM2에서 반복적으로 발생하던 문제들을 FM3에서 완전히 정리:

문제(FM2)	FM3 개선
BERT tokenizer GPU/CPU mismatch	모든 text tensor GPU 이동 통합 관리
invalid token index로 CUDA assert	token_type_ids 자동 생성 및 안전 처리
일부 비디오에서 frame 부족 발생	frame 부족 시 반복 채움 / sampling 안정화
텍스트가 빈 경우 tokenizer crash	빈 문자열 안전 처리
오디오 길이가 다양한 경우 오류	zero-pad / crop 일관 적용
✔ 2) Manifest 구조를 평가 데이터와 호환되도록 단순화

Final Model2 manifest는 다음처럼 modality 구조가 복잡했음:

{
  "video": {...},
  "audio": {...},
  "text": {...},
  "labels": {...},
  "harmful": 0
}


Final Model3에서는 실 평가에 사용할 데이터 구조에 맞춰 아래처럼 단일 binary label + 단순 경로 구조로 통일함:

{
  "video_path": "...",
  "audio_path": "...",
  "text": "내용 또는 빈문자",
  "label": 0 or 1
}

➜ 장점

평가 데이터(수집 데이터)와 학습 데이터가 완전히 같은 구조로 정렬

Dataset이 단일 구조만 처리하므로 오류가 크게 감소

이미지/영상/오디오/텍스트 중 어떤 모달이 없어도 zero tensor로 안전 처리

✔ 3) 모델 구조 개선

기본 아키텍처는 FM2와 동일하나, 안정성과 일반화를 중심으로 재설계함.

🟪 Video Encoder

ResNet18 backbone → frame-level feature 추출

temporal average pooling

프레임 sampling 안정화 (frame 부족 시 반복 보충)

🟪 Audio Encoder

raw waveform 기반 Conv1d stack

robust resampling / zero-padding

🟪 Text Encoder

KoBERT CLS embedding

token_type_ids 자동 생성

padding/truncation max_len 엄격 적용

🟪 Fusion Network
1536 → 512 → 128 → sigmoid
Dropout 0.3, 0.2


Final Model2 대비 generalization 향상 및 안정적 학습이 가능하도록 개선.

✔ 4) Train Loop 완전 리팩토링

Final Model2에서 자주 발생한 평가(Validation) 오류들을 FM3에서 모두 해결:

◼ 해결한 문제들

리스트 안에 dict가 들어가서 발생하던
TypeError: '>=' not supported between float and dict

logits → probs 변환 안정화

label dtype mismatch 문제 해결

threshold 적용 단계 정교화

2. Final Model3 데이터 처리 방식
✔ 1) 기존 학습 데이터 + 평가용 데이터 간 구조 일치

Final Model3는 평가 데이터가 기존 데이터와 동일한 형식으로 전처리되어도 바로 manifest에 포함 가능하도록 설계됨.

평가용 데이터에서도

video_path

audio_path

text

label (harmful/safe only)
만 맞추면 즉시 학습/추론 가능

➜ 카테고리 기반 라벨링(weapons, alcohol 등)은

FM3에서는 binary label로 변환하여 사용함.

3. Final Model3의 목표

Final Model3는 팀의 최종 평가에서 다음을 목표로 한다.

🎯 목표

Video + Audio + Text 멀티모달 특징을 모두 활용

Final Model2 대비 학습 안정성 증가

실 평가 데이터에 완전 호환되는 구조

threshold tuning 포함한 높은 F1-score

4. Final Model3 폴더 구성
final_model3/
 ├── dataset.py       # 완전 리팩토링된 멀티모달 로더
 ├── model.py         # 안정화된 Video/Audio/Text encoder + fusion
 ├── train.py         # threshold/val loop 개선된 train runner
 ├── build_manifest_final3.py  # 평가데이터 포함 manifest builder
 ├── config.yaml      # hyper-parameters + 경로 통합
 └── README.md        # (현재 문서)

5. Final Model3 요약
항목	Final Model2	Final Model3
멀티모달 구성	동일	동일
Manifest 구조	복잡함	단일화(binary)
학습 오류	잦음 (CUDA assert 등)	전부 해결
전처리	부분 모듈	통합 + 안정화
평가 데이터 호환성	불완전	완전 호환
Threshold 안정성	낮음	향상됨