# 무하유 팀원용 데이터 라벨링 가이드 (카테고리 분류)

> **작성자**: 박상원  
> **작성일**: 2025년 2학기  
> **버전**: 2.0

---

## 📋 개요

### 목적
- 최종 독립 평가용 **1200개 데이터** (3명 × 400개) 라벨링
- 각 팀원의 모델 성능을 **카테고리별로 평가**
- 어떤 유형의 유해 콘텐츠를 잘/못 탐지하는지 확인
- 3개 모델 중 최고 성능 모델 선정

### 데이터 구성 (인당 400개)
- 안전 이미지: 100개
- 유해 이미지: 100개
- 안전 비디오: 100개
- 유해 비디오: 100개
- **총 3명 = 1200개**

### 특징
- ✅ **완전 수동 라벨링** (YOLO 없음)
- ✅ **10개 카테고리** 세분화
- ✅ 4개 폴더의 모든 파일을 하나로 통합 라벨링
- ✅ **파일 해시 기반 중복 검출** - 파일명이 달라도 동일한 파일 자동 제외
- ✅ **최종 독립 평가용** (학습/테스트에 사용 안 함)
- ⚠️ **중요**: 내가 모은 400개를 내 모델 학습에 사용 금지!

---

## 🎯 10개 카테고리 정의

| 번호 | 영문 | 한글 | 설명 | 평가 포함 |
|------|------|------|------|----------|
| **1** | weapons | 무기 | 칼, 총 등 | ✅ |
| **2** | violence | 폭력 | 싸움, 공격 | ✅ |
| **3** | alcohol | 음주 | 술, 취함 | ✅ |
| **4** | smoking | 흡연 | 담배 | ✅ |
| **5** | drugs | 약물 | 마약 | ✅ |
| **6** | blood | 혈액/상처 | 피, 상처 | ✅ |
| **7** | threat | 위협 | 협박 | ✅ |
| **8** | sexual | 성적콘텐츠 | 음란물 등 | ✅ |
| **9** | dangerous | 위험행동 | 자해 등 | ✅ |
| **0** | safe | 안전 | 유해 아님 | ✅ |
| **S** | skip | 건너뛰기 | 판단 불가 | ❌ |

### 중요한 차이점 ⚠️

**0 (안전) vs S (건너뛰기)**
- **0 (safe)**: 유해하지 않은 정상 콘텐츠 → **모델 평가에 포함됨**
  - 예: 풍경, 일상, 동물, 음식, 공원, 하늘 등
  - JSON에 저장되어 모델이 "안전"하다고 판단해야 하는 정답 데이터로 사용
  
- **S (skip)**: 판단하기 애매하거나 불확실한 콘텐츠 → **모델 평가에서 제외**
  - 예: 화질 너무 나쁨, 무슨 내용인지 모르겠음, 카테고리 애매함
  - JSON에 저장되지 않아 최종 평가 데이터에 포함 안 됨

### ⚠️ 매우 중요: 폴더 이름 ≠ 최종 라벨

**폴더는 수집 시 분류일 뿐, 최종 라벨은 수동 선택한 카테고리가 정답입니다!**

예시:
```
❌ 잘못된 생각: "비디오" 폴더에 있으니까 무조건 유해
✅ 올바른 방법: 실제로 보고 판단

📂 박상원/비디오/video1.mp4 (유해 폴더)
   → 내용: 풍경 영상
   → 선택: 0 (안전) → JSON에 "is_harmful": false ✅
   → 결과: 안전 비디오로 평가됨

📂 박상원/안전_비디오/video2.mp4 (안전 폴더)  
   → 내용: 칼 들고 있음
   → 선택: 1 (무기) → JSON에 "is_harmful": true ✅
   → 결과: 유해 비디오로 평가됨
```

**핵심**: 폴더 이름 무시하고 실제 내용만 보고 판단!

### 🔁 자동 중복 검출 기능

**파일명이 달라도 내용이 같으면 자동으로 건너뜁니다!**

```
예시 상황:
📂 이미지/gun.jpg → 라벨링: 1 (무기) ✅
📂 이미지/gun_copy.jpg → 🔁 중복 파일 (자동 건너뛰기) ❌
📂 안전_이미지/gun.jpg → 🔁 중복 파일 (자동 건너뛰기) ❌

✅ 장점:
- 같은 파일을 여러 번 라벨링하는 수고 감소
- 데이터 중복으로 인한 평가 왜곡 방지
- 라벨링 시간 단축

📊 작동 방식:
1. 모든 파일의 MD5 해시값 계산 (파일 내용 기반)
2. 이미 라벨링한 파일의 해시값 저장
3. 새 파일의 해시가 이미 있으면 자동 건너뛰기
4. 콘솔에 "🔁 중복 파일 (건너뛰기)" 표시
```

---

## 🚀 사전 준비

### 1. Python 패키지 설치
```bash
pip install opencv-python numpy
```

### 2. 폴더 구조 확인

```
무하유_유해콘텐츠_데이터_모델선정/
├── 2_실제_수집_데이터/
│   ├── 박상원/
│   │   ├── 이미지/          # 유해 이미지
│   │   ├── 안전_이미지/     # 안전 이미지
│   │   ├── 비디오/          # 유해 비디오
│   │   └── 안전_비디오/     # 안전 비디오
│   ├── 안지산/ (동일 구조)
│   └── 임영재/ (동일 구조)
│
└── 3_라벨링_파일/
    ├── 박상원/
    │   └── 박상원_labels_categorized.json  ← 여기에 저장됨
    ├── 안지산/
    │   └── 안지산_labels_categorized.json
    └── 임영재/
        └── 임영재_labels_categorized.json
```

**중요**: 
- 각자 `2_실제_수집_데이터/{이름}/` 폴더에 4개 하위 폴더로 데이터 저장
- 라벨링 결과는 `3_라벨링_파일/{이름}/` 폴더에 자동 생성

---

## 📝 라벨링 실행

### 1. 설정 수정

`team_labeling_tool_with_category.py` 파일 열어서 **이름만 수정**:

```python
# ⚙️ 설정 부분
TEAM_MEMBER_NAME = "박상원"  # ← 여기만 수정! "안지산", "임영재", "박상원"
```

### 2. 실행

```bash
python team_labeling_tool_with_category.py
```

### 3. 라벨링 방법

#### 화면 구성
- 이미지 또는 비디오 중간 프레임이 표시됨
- 상단에 `[진행/전체] 폴더명/파일명` 표시

#### 키보드 입력
- **0-9**: 카테고리 선택
- **S**: 건너뛰기
- **Q**: 종료

#### 진행 과정
1. 4개 폴더의 모든 파일을 순회
2. 화면에 파일 표시
3. 0-9 키로 카테고리 선택
4. 10개마다 자동 저장
5. 이미 라벨링한 파일은 자동 건너뛰기

### 4. 출력 확인

```
3_라벨링_파일/
└── 박상원/
    └── 박상원_labels_categorized.json  ← 생성됨
```

---

## 💡 카테고리 선택 가이드

### 명확한 경우

| 보이는 내용 | 선택 | 평가 포함 |
|-------------|------|----------|
| 칼, 총, 무기 | **1** | ✅ |
| 싸우는 장면 | **2** | ✅ |
| 술, 취한 사람 | **3** | ✅ |
| 담배 피우기 | **4** | ✅ |
| 주사기, 마약 | **5** | ✅ |
| 피, 상처 | **6** | ✅ |
| 위협 자세 | **7** | ✅ |
| 성적 내용 | **8** | ✅ |
| 자해, 위험운전 | **9** | ✅ |
| **풍경, 일상, 동물, 음식** | **0 (안전)** | ✅ |
| **화질 나쁨, 판단 불가** | **S (건너뛰기)** | ❌ |

### 애매한 경우

**우선순위** (심각한 순서):  
1. 무기 > 2. 약물 > 3. 성적콘텐츠 > 4. 폭력 > 5. 위협 > 6. 혈액 > 7. 위험행동 > 8. 흡연 > 9. 음주

**예시**:
- 칼 들고 싸우기 → **1** (무기가 더 심각)
- 술 마시면서 싸우기 → **2** (폭력이 더 심각)
- 유해한지 애매함 → **0** (안전)
- 모르겠음 → **S** (건너뛰기)

---

## 📊 출력 파일 형식

### `박상원_labels_categorized.json`

```json
{
  "knife_001.jpg": {
    "type": "image",
    "source_folder": "이미지",
    "category": "weapons",
    "category_label": "무기",
    "is_harmful": true
  },
  "fight_video.mp4": {
    "type": "video",
    "source_folder": "비디오",
    "duration": 10.5,
    "fps": 30.0,
    "total_frames": 315,
    "category": "violence",
    "category_label": "폭력",
    "is_harmful": true
  },
  "safe_nature.jpg": {
    "type": "image",
    "source_folder": "안전_이미지",
    "category": "safe",
    "category_label": "안전",
    "is_harmful": false
  }
}
```

---

## 🔧 문제 해결

### Q1. 패키지 설치 오류
```bash
pip install opencv-python numpy
```

### Q2. 폴더가 없다는 오류
- `2_실제_수집_데이터/{이름}/` 폴더 확인
- 4개 하위 폴더 확인: 이미지, 안전_이미지, 비디오, 안전_비디오

### Q3. 중간에 종료했는데?
- 다시 실행하면 이미 라벨링한 파일은 자동으로 건너뜀
- 안 한 것만 이어서 진행

### Q4. 한글 경로 문제
- 코드에서 한글 경로 지원함
- 문제 있으면 보고

### Q5. 카테고리 선택이 어려움
- 팀원들과 기준 정하기
- 애매하면 **S(건너뛰기)**

---

## ✅ 체크리스트

### 라벨링 전
- [ ] Python 패키지 설치 (`opencv-python`, `numpy`)
- [ ] 폴더 구조 확인
- [ ] 데이터 수집 완료 (4개 폴더에 분산)
- [ ] 설정 파일에서 이름 수정
- [ ] 10개 카테고리 숙지

### 라벨링 중
- [ ] 일관된 기준으로 선택
- [ ] 애매하면 건너뛰기
- [ ] 10개마다 자동 저장 확인

### 라벨링 후
- [ ] `3_라벨링_파일/{이름}/{이름}_labels_categorized.json` 파일 생성 확인
- [ ] 카테고리별 통계 확인 (콘솔 출력)
- [ ] 전체 파일 라벨링 완료

---

## 📈 최종 평가 방법

### ⚠️ 중요: 독립 평가
- **각자가 모은 400개 데이터는 자신의 모델 학습에 사용하면 안 됩니다!**
- 이 1200개 데이터는 오직 **최종 평가용**입니다
- 학습은 기존 데이터로만 진행

### 1. 평가 흐름
```python
# 박상원의 모델로 전체 1200개 데이터 평가
model = load_model('박상원_model.pth')  # 내 모델 (내 400개로 학습 안 함!)

# 전체 1200개 데이터 로드 (박상원 400 + 안지산 400 + 임영재 400)
# 각 팀원당: 안전 이미지 100 + 유해 이미지 100 + 안전 비디오 100 + 유해 비디오 100
all_data = []
all_labels = []

for member in ['박상원', '안지산', '임영재']:
    # 각 팀원의 데이터 로드 (4개 폴더)
    data_paths = [
        f'2_실제_수집_데이터/{member}/이미지/',        # 유해 이미지 100
        f'2_실제_수집_데이터/{member}/안전_이미지/',   # 안전 이미지 100
        f'2_실제_수집_데이터/{member}/비디오/',        # 유해 비디오 100
        f'2_실제_수집_데이터/{member}/안전_비디오/'    # 안전 비디오 100
    ]
    
    # 각 팀원의 라벨 로드
    labels = load_labels(f'3_라벨링_파일/{member}/{member}_labels_categorized.json')
    
    all_data.extend(load_data(data_paths))
    all_labels.extend(labels)

# 전체 1200개로 평가
predictions = model.predict(all_data)
evaluate(predictions, all_labels)  # 전체 성능
evaluate_by_category(predictions, all_labels)  # 카테고리별 성능
```

### 2. 카테고리별 성능 분석
```
[weapons] (샘플 25개)
  Precision: 0.92
  Recall: 0.88
  F1-Score: 0.90  ✅ 우수

[violence] (샘플 30개)
  Precision: 0.85
  Recall: 0.78
  F1-Score: 0.81  ✔️ 양호

[alcohol] (샘플 18개)
  Precision: 0.70
  Recall: 0.60
  F1-Score: 0.65  ⚠️ 개선 필요
  → 음주 카테고리 약함
```

### 3. 최종 모델 선정
- 각 팀원의 모델을 **동일한 1200개 데이터**로 평가
- 전체 F1-Score 비교
- **카테고리별 성능** 고려
- 어떤 유형을 잘/못 탐지하는지 분석
- 가장 우수한 모델 선정

### 4. 독립 평가 주의사항
✅ **해야 할 것**:
- 1200개 데이터로 **최종 평가만** 수행
- 각 팀원의 모델을 동일한 기준으로 비교
- 카테고리별 성능 분석

❌ **하면 안 되는 것**:
- 내가 모은 400개를 내 모델 학습에 사용
- 다른 팀원 데이터로 학습 (기존 데이터로만 학습!)
- 평가 데이터 유출

---

## 🎯 핵심 포인트

1. **완전 수동 라벨링**
   - YOLO 없음
   - 사용자 판단만으로 카테고리 선택

2. **4개 폴더 통합 (인당 400개)**
   - 이미지 100 + 안전_이미지 100 + 비디오 100 + 안전_비디오 100
   - 모든 파일을 하나의 JSON에 라벨링

3. **⚠️ 독립 평가용 데이터 (매우 중요!)**
   - **내가 모은 400개를 내 모델 학습에 절대 사용 금지!**
   - 1200개 데이터는 오직 **최종 평가용**
   - 학습은 기존 데이터로만 진행
   - 3개 모델을 동일한 1200개로 공정하게 비교

4. **카테고리별 성능 분석**
   - 어떤 유형에서 성능이 떨어지는지 확인
   - 모델 개선 방향 도출
   - 최종 모델 선정 기준

---

**끝!**

궁금한 점 있으면 박상원에게 연락주세요.
