# 유해 콘텐츠 탐지 모델 최종 평가 보고서

## 1. 프로젝트 개요

### 1.1 모델 정보
- **모델 버전**: Final Model 11 (카테고리 기반 구조)
- **평가 데이터**: 실제 수집 데이터 1,221개 (이미지 586개, 비디오 635개)
- **평가 대상**: 박상원, 안지산, 임영재 세 명의 수집 데이터

### 1.2 모델 아키텍처

#### 이미지 모델
- **구조**: YOLOv8 + CLIP + 행동 인식 + 차원 축소 MLP
- **입력 차원**: 540차원 (YOLO 20 + CLIP 512 + 행동 8)
- **Threshold**: 0.4000

#### 비디오 모델
- **구조**: YOLOv8 + SlowFast + CLIP + 행동 인식 + Transformer
- **입력 차원**: 940차원 (YOLO 20 + CLIP 512 + SlowFast 400 + 행동 8)
- **프레임 샘플링**: 32프레임
- **Threshold**: 0.4000

### 1.3 탐지 카테고리

**유해 객체 (20종)**
- 무기류 (12종): knife, dagger, machete, sword, axe, gun, pistol, rifle, shotgun, machine_gun, grenade, bomb
- 음주 (2종): wine glass, beer
- 흡연 (2종): cigarette, lighter
- 약물 (1종): syringe
- 혈액/상처 (3종): blood, injury, wound

**유해 행동 (8종)**
- violence (폭력), alcohol (음주), smoking (흡연), drugs (약물)
- blood (혈액/상처), threat (위협), sexual (성적 콘텐츠), dangerous (위험행동)

---

## 2. 평가 결과 요약

### 2.1 전체 성능 지표

#### 이미지 모델 (586개 평가)
| 메트릭 | 값 | 설명 |
|--------|-----|------|
| **Accuracy** | 0.6706 | 전체 정확도 67.06% |
| **Precision** | 0.5524 | 유해로 예측한 것 중 실제 유해 비율 55.24% |
| **Recall** | 0.9231 | 실제 유해인 것 중 유해로 예측한 비율 92.31% |
| **F1-Score** | 0.6912 | Precision과 Recall의 조화 평균 69.12% |

**혼동 행렬**
- TN (True Negative): 177개
- FP (False Positive): 175개
- FN (False Negative): 18개
- TP (True Positive): 216개

#### 비디오 모델 (635개 평가)

**Export 버전 1 (박상원 모델 - 박상원 샘플링 방식) ⭐ 최종 모델**
- **설명**: 박상원의 본래 모델과 샘플링 방식을 사용한 평가
- **샘플링 방식**: 
  - 비디오 전체에서 32프레임 균등 샘플링 (`np.linspace` 사용)
  - 32개 미만일 경우 마지막 프레임 반복하여 패딩
  - 2초 클립으로 나누지 않고, 비디오 전체에서 32프레임 세트 하나만 처리

| 메트릭 | 값 |
|--------|-----|
| **Accuracy** | 0.5795 |
| **Precision** | 0.5435 |
| **Recall** | 0.8312 |
| **F1-Score** | 0.6573 |

**혼동 행렬**
- TN: 112개, FP: 215개
- FN: 52개, TP: 256개

**Export 버전 2 (박상원 모델 - 임영재 샘플링 방식) 🔬 비교 실험용**
- **설명**: 박상원 모델에 임영재의 샘플링 방식을 적용한 비교 실험
- **샘플링 방식**:
  - 비디오 전체를 2초 단위 클립으로 분할
  - 각 구간에서 연속된 32프레임 윈도우를 stride 32로 슬라이딩
  - 32프레임 미만인 윈도우는 패딩 없이 제거
  - 모든 윈도우를 처리한 후, confidence 최대값과 객체/행동 union으로 결과 집계

| 메트릭 | 값 |
|--------|-----|
| **Accuracy** | 0.5606 |
| **Precision** | 0.5268 |
| **Recall** | 0.9253 |
| **F1-Score** | 0.6714 |

**혼동 행렬**
- TN: 71개, FP: 256개
- FN: 23개, TP: 285개

**비교 결과 분석**:
- Export 2는 재현율이 높아졌지만(92.53% vs 83.12%), 정확도와 정밀도는 하락
- 프레임을 늘린 결과 성능이 낮아짐 → 학습 시 프레임이 낮은 상태에서 학습하여 발생한 것으로 추정
- **결론**: 박상원 모델은 본래 샘플링 방식(Export 1)이 더 적합

---

## 3. 팀원별 모델 성능 비교 및 최종 선정

### 3.1 팀원별 모델 성능 비교

#### 이미지 모델 성능 비교
| 구분 | Accuracy | Precision | Recall | F1-Score |
|------|----------|-----------|--------|----------|
| **박상원** | **67.06%** | **55.24%** | **92.31%** | **69.12%** |
| 임영재 | 67.77% | 57.28% | 75.64% | 65.20% |
| 안지산 | 39.37% | 39.37% | 100.00% | 56.49% |

**분석**:
- **박상원**: F1 점수 최고 (69.12%), 재현율 매우 높음 (92.31%)
- 임영재: 정확도와 정밀도는 약간 높으나 재현율이 상대적으로 낮음 (75.64%)
- 안지산: 재현율 100%이나 정밀도와 정확도가 매우 낮아 실용성 떨어짐

#### 비디오 모델 성능 비교
| 구분 | Accuracy | Precision | Recall | F1-Score | 비고 |
|------|----------|-----------|--------|----------|------|
| 박상원 (Export 1) ⭐ | 57.95% | 54.35% | 83.12% | 65.73% | 본래 모델 |
| 박상원 (Export 2) 🔬 | 56.06% | 52.68% | 92.53% | 67.14% | 비교 실험용 |
| **임영재** | **71.02%** | **66.23%** | **82.14%** | **73.30%** | 최종 선정 |
| 안지산 | 39.37% | 39.37% | 100.00% | 56.49% | 제외 |

**분석**:
- **임영재**: 모든 지표에서 우수 (F1 73.30%, Accuracy 71.02%)
- 박상원 Export 1: 본래 모델로 F1 65.73%, 재현율 83.12%
- 박상원 Export 2: 비교 실험용으로 재현율은 높으나 정확도 하락
- 안지산: 재현율 100%이나 정밀도와 정확도가 매우 낮아 실용성 떨어짐

### 3.2 최종 모델 선정 결과

#### 선정 모델

| 모델 타입 | 선정자 | 주요 성능 지표 | 선정 이유 |
|-----------|--------|----------------|-----------|
| **이미지 모델** | **박상원** | F1: **69.12%**, Recall: **92.31%** | • F1 점수 최고 (69.12%)<br>• 재현율 92.31%로 유해 콘텐츠 탐지율 매우 높음<br>• Precision과 Recall의 균형이 좋음 |
| **비디오 모델** | **임영재** | F1: **73.30%**, Accuracy: **71.02%** | • F1 점수 최고 (73.30%)<br>• 정확도 71.02%로 가장 높음<br>• Precision 66.23%로 오탐 적음<br>• 재현율 82.14%로 양호 |

#### 선정 근거

**이미지 모델 (박상원 모델 선정)**
1. **F1 점수 우수**: 69.12%로 가장 높음
2. **높은 재현율**: 92.31%로 실제 유해 이미지의 92%를 탐지
3. **균형잡힌 성능**: Precision과 Recall의 조화가 좋음
4. **실용성**: 유해 콘텐츠를 놓치는 경우가 적어 실무 적용에 적합

**비디오 모델 (임영재 모델 선정)**
1. **종합 성능 최우수**: F1 점수 73.30%로 가장 높음
2. **높은 정확도**: 71.02%로 전체 분류 정확도가 우수
3. **양호한 정밀도**: 66.23%로 오탐 비율이 낮음
4. **적절한 재현율**: 82.14%로 유해 비디오 탐지율이 충분히 높음
5. **균형잡힌 성능**: 모든 지표에서 안정적인 성능
6. **비교 실험 결과**: 동일 조건 비교에서도 가장 우수한 성능

**참고**: 박상원 모델의 Export 2는 비교 실험용으로, 본래 모델(Export 1)과 임영재 모델과의 공정한 비교를 위해 임영재의 샘플링 방식을 적용한 것입니다.

#### 제외된 모델 분석

**안지산 모델 (이미지/비디오 모두 제외)**
- **문제점**:
  - Accuracy 39.37%로 매우 낮음 (실제로는 거의 모든 것을 유해로 분류)
  - Precision 39.37%로 오탐 비율이 매우 높음
  - Threshold 최적화 결과 0.00으로, 모든 샘플을 유해로 분류
- **결론**: 실무 적용 불가능 (과도한 오탐)

---

## 4. 카테고리별 상세 분석

### 4.1 이미지 카테고리별 성능 (박상원 모델)

#### 우수한 성능 카테고리 (F1 ≥ 0.95)
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 |
|----------|----------|--------|--------|--------|-----|
| **흡연** | 41개 (7.00%) | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| **성적 콘텐츠** | 12개 (2.05%) | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| **약물** | 16개 (2.73%) | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| **혈액/상처** | 19개 (3.24%) | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| **무기** | 78개 (13.31%) | 0.9615 | 1.0000 | 0.9615 | 0.9804 |
| **위협** | 18개 (3.07%) | 0.9444 | 1.0000 | 0.9444 | 0.9714 |

#### 양호한 성능 카테고리 (0.7 ≤ F1 < 0.95)
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 |
|----------|----------|--------|--------|--------|-----|
| **음주** | 32개 (5.46%) | 0.9062 | 1.0000 | 0.9062 | 0.9508 |
| **위험행동** | 7개 (1.19%) | 0.8571 | 1.0000 | 0.8571 | 0.9231 |

#### 개선이 필요한 카테고리
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 | 문제점 |
|----------|----------|--------|--------|--------|-----|--------|
| **폭력** | 11개 (1.88%) | 0.0909 | 1.0000 | 0.0909 | 0.1667 | 데이터 부족으로 재현율 매우 낮음 |
| **안전** | 352개 (60.07%) | 0.5028 | 0.0000 | 0.0000 | 0.0000 | FP 175개 발생 (안전을 유해로 오분류) |

### 4.2 비디오 카테고리별 성능 (박상원 모델 - Export 버전 2)

#### 우수한 성능 카테고리 (F1 ≥ 0.95) - Export 버전 2
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 |
|----------|----------|--------|--------|--------|-----|
| **무기** | 36개 (5.67%) | 1.0000 | 1.0000 | 1.0000 | 1.0000 |
| **폭력** | 121개 (19.06%) | 0.9917 | 1.0000 | 0.9917 | 0.9959 |
| **약물** | 31개 (4.88%) | 0.9677 | 1.0000 | 0.9677 | 0.9836 |
| **위험행동** | 24개 (3.78%) | 0.9167 | 1.0000 | 0.9167 | 0.9565 |
| **성적 콘텐츠** | 24개 (3.78%) | 0.9167 | 1.0000 | 0.9167 | 0.9565 |
| **위협** | 19개 (2.99%) | 0.8947 | 1.0000 | 0.8947 | 0.9444 |

#### 양호한 성능 카테고리
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 |
|----------|----------|--------|--------|--------|-----|
| **흡연** | 15개 (2.36%) | 0.8667 | 1.0000 | 0.8667 | 0.9286 |
| **음주** | 25개 (3.94%) | 0.6400 | 1.0000 | 0.6400 | 0.7805 |
| **혈액/상처** | 13개 (2.05%) | 0.6923 | 1.0000 | 0.6923 | 0.8182 |

#### 개선이 필요한 카테고리
| 카테고리 | 데이터 수 | 정확도 | 정밀도 | 재현율 | F1 | 문제점 |
|----------|----------|--------|--------|--------|-----|--------|
| **안전** | 327개 (51.50%) | 0.2171 | 0.0000 | 0.0000 | 0.0000 | FP 256개 발생 (안전을 유해로 오분류) |

---

## 5. 주요 발견사항 및 분석

### 5.1 강점

1. **높은 재현율 (Recall)**
   - 이미지: 92.31% (박상원 모델) - 실제 유해 콘텐츠의 92%를 탐지
   - 비디오: 82.14% (임영재 모델) - 실제 유해 비디오의 82%를 탐지
   - **의미**: 유해 콘텐츠를 놓치는 경우가 적음 (False Negative 낮음)

2. **카테고리별 정밀도**
   - 대부분의 유해 카테고리에서 정밀도 1.0000 (100%)
   - 유해로 예측한 경우 대부분 실제로 유해
   - **의미**: 오탐이 적음 (False Positive 낮음)

3. **특정 카테고리 우수 성능**
   - 무기, 흡연, 약물, 성적 콘텐츠 등에서 F1 점수 0.95 이상
   - 명확한 객체/행동 기반 탐지 카테고리에서 강한 성능

### 5.2 개선이 필요한 부분

1. **안전 콘텐츠 오분류**
   - 이미지: 안전 352개 중 175개를 유해로 오분류 (49.7%) - 박상원 모델
   - 비디오: 안전 콘텐츠 오분류 문제 존재
   - **원인**: 모델이 보수적으로 작동하여 안전한 콘텐츠도 유해로 판단
   - **영향**: 정밀도 하락, 사용자 경험 저하

2. **폭력 카테고리 낮은 재현율** (이미지)
   - 11개 중 10개를 놓침 (재현율 9.09%)
   - **원인**: 데이터 부족 (11개만 존재, 전체의 1.88%)
   - **해결방안**: 폭력 데이터 증강 필요

3. **데이터 불균형**
   - 안전 데이터가 전체의 60% (이미지), 51.5% (비디오)
   - 일부 카테고리 데이터 부족 (폭력 11개, 위험행동 7개 등)
   - **영향**: 소수 카테고리의 성능 지표 신뢰도 낮음

### 5.3 모델-샘플링 방식 조합 비교 실험

#### 실험 설계

비디오 모델 평가 시 서로 다른 프레임 샘플링 방식을 교차 적용하여 공정한 비교를 수행했습니다.

| 실험 번호 | 모델 | 샘플링 방식 | 상태 | 결과 위치 |
|-----------|------|-------------|------|-----------|
| **1) 상원-상원** | 박상원 모델 | 박상원 샘플링 | ✅ 완료 | Export 버전 1 |
| **2) 상원-영재** | 박상원 모델 | 임영재 샘플링 | ✅ 완료 | Export 버전 2 |
| **3) 영재-영재** | 임영재 모델 | 임영재 샘플링 | ✅ 완료 | 임영재 최종 결과 |
| **4) 영재-상원** | 임영재 모델 | 박상원 샘플링 | 🔄 진행 중 | - |

#### 샘플링 방식 상세 비교

**박상원 샘플링 방식** (균등 샘플링)
```
1. 비디오 전체에서 FRAME_SAMPLE(32)개 프레임 균등 샘플링
   - np.linspace(0, total_frames - 1, 32)로 인덱스 생성
   - 해당 인덱스의 프레임만 추출

2. 32개 미만일 경우 마지막 프레임을 반복하여 32개로 패딩

3. 2초 클립으로 나누지 않고, 비디오 전체에서 
   이렇게 만든 32프레임 세트 하나만 처리
```

**임영재 샘플링 방식** (슬라이딩 윈도우)
```
1. 비디오 전체를 2초 단위 클립으로 분할

2. 각 구간에서 연속된 32프레임 윈도우를 stride 32로 슬라이딩

3. 32프레임이 안 되는 윈도우는 패딩 없이 제거

4. 각 윈도우를 모두 처리한 뒤,
   - confidence 최대값 사용
   - 객체/행동 union으로 결과 집계
```

#### Export 버전 1 vs 버전 2 비교 (박상원 모델)

| 항목 | Export 1<br>(상원-상원) | Export 2<br>(상원-영재) | 변화 |
|------|------------------------|------------------------|------|
| **비디오 Accuracy** | 0.5795 | 0.5606 | -1.89%p ⬇️ |
| **비디오 Precision** | 0.5435 | 0.5268 | -1.67%p ⬇️ |
| **비디오 Recall** | 0.8312 | 0.9253 | +9.41%p ⬆️ |
| **비디오 F1** | 0.6573 | 0.6714 | +1.41%p ⬆️ |
| **FP (안전→유해)** | 215개 | 256개 | +41개 |
| **FN (유해→안전)** | 52개 | 23개 | -29개 ⬇️ |

**분석**:
- Export 2는 재현율이 높아져 유해 콘텐츠를 더 잘 탐지(+9.41%p)
- 하지만 정확도와 정밀도는 하락(-1.89%p, -1.67%p)
- **주요 원인**: 프레임을 늘린 결과 성능이 낮아짐 → 학습 시 프레임이 낮은 상태에서 학습하여 발생
- **결론**: 박상원 모델은 본래 샘플링 방식(Export 1)이 더 적합 ⭐

#### 최종 모델 선정 기준

같은 조건에서 비교하기 위해:
- **이미지 모델**: 박상원 모델 선정 (F1: 69.12%)
- **비디오 모델**: 임영재 모델 선정 (F1: 73.30%)
  - 임영재 모델이 자신의 샘플링 방식에서 더 높은 성능을 보임
  - 박상원 모델의 Export 2는 비교 실험용으로만 사용

---

## 6. 모델 특징 및 기술

### 6.1 멀티모달 특징 융합
- **YOLO**: 객체 탐지 (무기, 음주, 흡연 등)
- **CLIP**: Zero-shot 행동/맥락 인식
- **SlowFast** (비디오): 시간적 행동 인식
- **규칙 기반 추론**: YOLO 객체 기반 카테고리 추론

### 6.2 특수 처리 로직
- **무기 탐지**: CLIP Zero-shot + YOLO 조합
- **위협 탐지**: 무기 + 사람 조합 시 민감도 증가
- **행동 인식**: CLIP 점수 60% + 규칙 기반 40% 융합

### 6.3 최적화
- CLIP 텍스트 특징 캐싱으로 속도 향상
- GPU 자동 감지 및 Mixed Precision 사용
- 프레임 샘플링으로 비디오 처리 효율화

---

## 7. 결론 및 향후 개선 방향

### 7.1 결론

**최종 선정 모델**
- **이미지 모델**: 박상원 모델 (F1: 69.12%, Recall: 92.31%)
- **비디오 모델**: 임영재 모델 (F1: 73.30%, Accuracy: 71.02%)

**종합 평가**
- **실용성**: 높은 재현율로 유해 콘텐츠 탐지에 효과적
  - 이미지: 92.31% 재현율로 유해 콘텐츠 놓치는 경우 적음 (박상원 모델)
  - 비디오: 82.14% 재현율로 유해 비디오 탐지율 양호 (임영재 모델)
- **정확성**: 유해 카테고리에서 높은 정밀도 (100%)
- **개선 필요**: 안전 콘텐츠 오분류율 감소 필요

**비교 실험 결과**
- 박상원 모델은 본래 샘플링 방식(Export 1)에서 더 나은 성능
- 서로 다른 샘플링 방식을 교차 적용하여 공정한 비교 수행
- 최종 선정: 이미지 - 박상원 모델, 비디오 - 임영재 모델

### 7.2 향후 개선 방향

1. **안전 콘텐츠 학습 강화**
   - 안전 데이터 증강
   - 안전 패턴 학습 강화

2. **데이터 불균형 해결**
   - 소수 카테고리 데이터 증강 (특히 폭력)
   - 클래스 가중치 조정

3. **임계값 최적화**
   - 카테고리별 다른 임계값 적용
   - ROC 곡선 기반 최적 임계값 탐색

4. **후처리 로직 개선**
   - 맥락 정보 활용 (전체 비디오/이미지 세트 분석)
   - 사용자 피드백 기반 학습

---

## 8. 평가 환경

- **GPU**: NVIDIA GeForce RTX 4070 SUPER
- **프레임워크**: PyTorch with CUDA
- **평가 데이터**: 
  - 이미지: 586개 (유해 234, 안전 352)
  - 비디오: 635개 (유해 308, 안전 327)
- **평가 시간**: 이미지 약 1분, 비디오 약 40분~4시간 (버전별 차이)

---

## 부록: 최종 선정 모델 요약

### ✅ 최종 선정 모델

| 모델 타입 | 선정자 | 주요 성능 지표 |
|-----------|--------|----------------|
| **이미지 탐지** | **박상원** | Accuracy: 67.06%<br>Precision: 55.24%<br>Recall: 92.31%<br>F1: 69.12% |
| **비디오 탐지** | **임영재** | Accuracy: 71.02%<br>Precision: 66.23%<br>Recall: 82.14%<br>F1: 73.30% |

### 📊 전체 모델 성능 비교

#### 이미지 모델
| 구분 | Accuracy | Precision | Recall | F1-Score | 선정 |
|------|----------|-----------|--------|----------|------|
| **박상원** | **67.06%** | **55.24%** | **92.31%** | **69.12%** | ✅ |
| 임영재 | 67.77% | 57.28% | 75.64% | 65.20% | - |
| 안지산 | 39.37% | 39.37% | 100.00% | 56.49% | - |

#### 비디오 모델
| 구분 | Accuracy | Precision | Recall | F1-Score | 선정 | 비고 |
|------|----------|-----------|--------|----------|------|------|
| 박상원 (Export 1) ⭐ | 57.95% | 54.35% | 83.12% | 65.73% | - | 본래 모델 |
| 박상원 (Export 2) 🔬 | 56.06% | 52.68% | 92.53% | 67.14% | - | 비교 실험용 |
| **임영재** | **71.02%** | **66.23%** | **82.14%** | **73.30%** | ✅ | 최종 선정 |
| 안지산 | 39.37% | 39.37% | 100.00% | 56.49% | - | 제외 |

---

> **작성자**: 박상원  
> **작성일**: 2025년 2학기